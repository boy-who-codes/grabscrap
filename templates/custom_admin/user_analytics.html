{% extends 'custom_admin/base.html' %}

{% block page_title %}User Analytics{% endblock %}
{% block page_description %}Detailed user statistics and growth metrics{% endblock %}

{% block content %}
<!-- User Statistics -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h3>{{ user_stats.total_users }}</h3>
                <p class="mb-0">Total Users</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h3>{{ user_stats.verified_users }}</h3>
                <p class="mb-0">Verified Users</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h3>{{ user_stats.active_users }}</h3>
                <p class="mb-0">Active Users</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h3>{{ user_stats.vendor_users }}</h3>
                <p class="mb-0">Vendors</p>
            </div>
        </div>
    </div>
</div>

<!-- User Growth Chart -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-graph-up"></i> User Growth</h5>
            </div>
            <div class="card-body">
                <canvas id="userGrowthChart" height="100"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-trophy"></i> Top Users</h5>
            </div>
            <div class="card-body">
                {% for user in top_users %}
                    <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                        <div>
                            <strong>{{ user.username }}</strong><br>
                            <small class="text-muted">{{ user.order_count }} orders</small>
                        </div>
                        <strong class="text-success">â‚¹{{ user.total_spent|floatformat:0 }}</strong>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// User Growth Chart
const growthCtx = document.getElementById('userGrowthChart').getContext('2d');
const userGrowth = {{ user_growth|safe }};

new Chart(growthCtx, {
    type: 'line',
    data: {
        labels: userGrowth.map(d => d.month),
        datasets: [{
            label: 'New Users',
            data: userGrowth.map(d => d.count),
            borderColor: '#0d6efd',
            backgroundColor: 'rgba(13, 110, 253, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}
